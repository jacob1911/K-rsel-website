<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin - Clubs</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
</head>

<body>
    <header>
        <h1 style="font-size: medium;">SAMKØRSEL TIL ORIENTERING</h1>

        <div class="header-inner">
            <!-- <a class="brand" href="/">Carpool</a> -->

            <button class="hamburger" aria-controls="primary-nav" aria-expanded="false" aria-label="Menu">
                <span></span><span></span><span></span>
            </button>

            <nav id="primary-nav" class="nav">
                <ul style="display: flex; gap: 20px; list-style: none; padding: 0; margin: 0;">
                    <li><a href="/" class="navbar-link">Tilbage til oversigt</a></li>
                </ul>

            </nav>
        </div>
    </header>

    <div class="main-wrapper">
        <div class="center-container">
            <h2>Add a Club</h2>
            <form action="{{ url_for('admin') }}" method="POST">
                <label for="club_name">Club Name</label>
                <input type="text" id="club_name" name="name" required>

                <label for="password">Password</label>
                <input type="text" id="password" name="password" required>

                <label for="description">Description</label>
                <input type="text" id="description" name="description">

                <button type="submit">Submit</button>
            </form>
            <br>
            <hr>
            <p>{{ clubs[1].name }}</p>
            <h2>Registered Clubs</h2>
            <table id="clubTable" style="width:100%; border-collapse: collapse; margin-top:20px;">
                <thead>
                    <tr style="background:#e8f5e9;">
                        <th style="padding:5px; text-align:left;">Club ID</th>
                        <th style="padding:10px; text-align:left;">Club Name</th>
                        <th style="padding:10px; text-align:left;">Description</th>
                        <th style="padding:10px; text-align:left;">Password</th>
                        <th style="padding:10px; text-align:left;">Amount of races</th>
                        <th style="padding:10px; text-align:left;">Remove</th>
                    </tr>
                </thead>
                <tbody>
                    {% for club in clubs %}
                    <tr>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ club.id }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ club.name }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ club.description }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ club.password }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ races_by_club[club.id]|length }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            <form onsubmit="return confirm('ER du sikker på at du vil slette denne klub?')"
                                action="{{ url_for('admin') }}" method="post">
                                <input type="hidden" name="delete_club_id" value="{{ club.id }}">
                                <button type="submit" class="delete-btn">Delete</button>
                            </form>
                        </td>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <script>
                $(document).ready(function () {
                    $('#clubTable').DataTable({
                        "order": [[0, "asc"]] // sort by date column by default
                    });
                });
            </script>
            <!-- TABEL 2 CARPOOLS -->
            <br>
            <hr>

            <h2>Registered races</h2>
            <table id="raceTable" style="width:100%; border-collapse: collapse; margin-top:20px;">
                <thead>
                    <tr style="background:#e8f5e9;">
                        <th style="padding:10px; text-align:left;">Race ID</th>
                        <th style="padding:10px; text-align:left;">Race name</th>
                        <th style="padding:10px; text-align:left;">Description</th>
                        <th style="padding:10px; text-align:left;">Date</th>
                        <th style="padding:10px; text-align:left;">Club name</th>
                        <th style="padding:10px; text-align:left;">Carpools antal</th>
                        <th style="padding:10px; text-align:left;">Remove</th>
                    </tr>
                </thead>
                <tbody>
                    {% for race in races %}
                    <tr class="race-row">
                        <td style="padding:5px; border-bottom:1px solid #c8e6c9;">
                            {{ race.id }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ race.name }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ race.description }}
                        </td>
                        <td class="race-date" style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ race.date }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {% if race.club_id %}
                            {{ clubs_dict[race.club_id].name }}
                            {% endif %}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            {{ carpools_by_races[race.id]|length }}
                        </td>
                        <td style="padding:10px; border-bottom:1px solid #c8e6c9;">
                            <form onsubmit="return confirm('ER du sikker på at du vil slette dette løb?')"
                                action="{{ url_for('admin') }}" method="post">
                                <input type="hidden" name="delete_race_id" value="{{ race.id }}">
                                <button type="submit" class="delete-btn">Delete</button>
                            </form>
                        </td>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
              <script>
                $(document).ready(function () {
                    $('#raceTable').DataTable({
                        "order": [[0, "asc"]] // sort by date column by default
                    });
                });
            </script>

            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const rows = document.querySelectorAll(".race-row");

                    rows.forEach(row => {
                        const dateCell = row.querySelector(".race-date");
                        const raceDate = new Date(dateCell.textContent); // get the date

                        const today = new Date();
                        today.setHours(0, 0, 0, 0); // remove time for comparison

                        if (raceDate < today) {
                            row.style.backgroundColor = "#f8d7da"; // past date → red
                        } else if (raceDate.toDateString() === today.toDateString()) {
                            row.style.backgroundColor = "#fff3cd"; // today → yellow
                        } else {
                            // row.style.backgroundColor = "#d4edda"; // future → green
                        }
                    });
                });
            </script>


        </div>
    </div>

    <footer>
        <p>&copy; 2025 Admin Panel</p>
    </footer>

    <script>
        function toggleMenu() {
            document.getElementById('navMenu').classList.toggle('open');
        }
    </script>
</body>

</html>